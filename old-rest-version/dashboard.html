<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>EduConnect â€“ Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <a class="brand" href="dashboard.html">EduConnect</a>
    <nav>
      <a href="index.html">Beranda</a>
      <a href="./student-service/student.html">Daftar Siswa</a>
      <a href="./course-service/course.html">Daftar Kursus</a>
    </nav>
  </header>

  <section id="fitur" class="fitur-section">
    <h2 class="fitur-title">Pilih Data yang Ingin Kamu Lihat</h2>

    <div class="fitur-grid">
      <a href="./student-service/student.html" class="fitur-card fitur-siswa">
        <div class="icon">ğŸ‘©â€ğŸ“</div>
        <h3>Daftar Siswa</h3>
        <p>
          Lihat data siswa yang sudah tersimpan dan terdaftar di EduConnect.
        </p>
      </a>

      <a href="./course-service/course.html" class="fitur-card fitur-kursus">
        <div class="icon">ğŸ“š</div>
        <h3>Daftar Kursus</h3>
        <p>
          Lihat daftar kursus atau materi belajar yang tersedia di EduConnect.
        </p>
      </a>
    </div>
  </section>

  <main class="wrapper">
    <section class="card">
      <div class="card-header">
        <h1>ğŸ” Preview Data</h1>
      </div>
      <div class="preview-grid">
        <div class="preview-card">
          <div class="preview-title">
            <h3>ğŸ‘©â€ğŸ“ Siswa Terbaru</h3>
            <a class="link-small" href="./student-service/student.html">Lihat semua</a>
          </div>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Nama</th>
                  <th>Email</th>
                </tr>
              </thead>
              <tbody id="preview-students">
                <tr><td colspan="2" class="text-center">Memuat...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="preview-card">
          <div class="preview-title">
            <h3>ğŸ“š Kursus Terbaru</h3>
            <a class="link-small" href="./course-service/course.html">Lihat semua</a>
          </div>
          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>Judul</th>
                  <th>Dosen</th>
                </tr>
              </thead>
              <tbody id="preview-courses">
                <tr><td colspan="2" class="text-center">Memuat...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <p>Â© EduConnect dirancang agar integrasi data antar layanan menjadi lebih mudah, aman, dan konsisten.</p>
  </footer>
  <script>
    (() => {
      const USERS_API = 'http://localhost:4000/gateway/users';
      const COURSES_API = 'http://localhost:4000/gateway/courses';

      const studentTbody = document.getElementById('preview-students');
      const courseTbody = document.getElementById('preview-courses');

      const safe = (value) => String(value == null ? '' : value)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');

      const loadStudents = async () => {
        try {
          const res = await fetch(USERS_API);
          if (!res.ok) throw new Error('Gagal memuat siswa');
          const data = await res.json();
          const top = data.slice(0, 3);
          if (!top.length) {
            studentTbody.innerHTML = '<tr><td colspan="2" class="text-center">Belum ada data.</td></tr>';
            return;
          }
          studentTbody.innerHTML = top.map(s =>
            `<tr><td>${safe(s.name)}</td><td>${safe(s.email)}</td></tr>`
          ).join('');
        } catch {
          studentTbody.innerHTML = '<tr><td colspan="2" class="text-center">Gagal memuat.</td></tr>';
        }
      };

      const loadCourses = async () => {
        try {
          const res = await fetch(COURSES_API);
          if (!res.ok) throw new Error('Gagal memuat kursus');
          const data = await res.json();
          const top = data.slice(0, 3);
          if (!top.length) {
            courseTbody.innerHTML = '<tr><td colspan="2" class="text-center">Belum ada data.</td></tr>';
            return;
          }
          courseTbody.innerHTML = top.map(c =>
            `<tr><td>${safe(c.title)}</td><td>${safe(c.lecturer)}</td></tr>`
          ).join('');
        } catch {
          courseTbody.innerHTML = '<tr><td colspan="2" class="text-center">Gagal memuat.</td></tr>';
        }
      };

      loadStudents();
      loadCourses();
    })();
  </script>
</body>
</html>